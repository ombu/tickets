<VirtualHost *:80>
    ServerName %(url)s
    RewriteEngine On
    # Double percentage below escapes Python string interpolation
    RewriteCond %%{HTTP_HOST} ^%(url)s$ [NC]
    RewriteRule ^(.*)$ https://%(url)s$1 [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    # Admin email, Server Name (domain name) and any aliases
    ServerAdmin martin@ombuweb.com
    ServerName %(url)s

    # Index file and Document Root (where the public files are located)
    DocumentRoot %(public_path)s

    # Custom log file locations
    ErrorLog  %(app_path)s/log/apache-error.log
    CustomLog %(app_path)s/log/apache-access.log combined

    # SSL
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs_local/ombuweb.com.pem
    SSLCertificateKeyFile /etc/ssl/certs_local/ombuweb.com.key
    #SSLCACertificateFile %(app_path)s/private/%(url)s.ca.crt

    # Load custom-compiled passenger
    LoadModule passenger_module /var/lib/gems/1.8/gems/passenger-3.0.19/ext/apache2/mod_passenger.so
    PassengerRoot /var/lib/gems/1.8/gems/passenger-3.0.19
    PassengerRuby /usr/bin/ruby1.8/

    <Directory />
        Options Indexes -ExecCGI FollowSymLinks -MultiViews
        Order allow,deny
        Allow from all

        SetEnv APPLICATION_ENV production
        # For Redmine 1.x, use RailsBaseURI, for Redmine 2.x, use RackBaseURI
        RailsBaseURI /
        # RackBaseURI /
        PassengerResolveSymlinksInDocumentRoot on
    </Directory>

</VirtualHost>
# vim:ft=apache
